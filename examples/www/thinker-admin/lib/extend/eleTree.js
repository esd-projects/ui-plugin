/** thinker-admin-v1.0.0 MIT License By http://www.thinkphp-admin.com/ */
 ;layui.define(["jquery","laytpl"],function(e){var n=layui.jquery,t=layui.laytpl,r=layui.hint(),i="eleTree",l={on:function(e,n){return layui.onevent.call(this,i,e,n)},render:function(e){var n=new d(e);return a.call(n)}},a=function(){var e=this,n=e.config;return{updateKeyChildren:function(t,r){if(0!==n.data.length)return e.updateKeyChildren.call(e,t,r)},updateKeySelf:function(t,r){if(0!==n.data.length)return e.updateKeySelf.call(e,t,r)},remove:function(t){if(0!==n.data.length)return e.remove.call(e,t)},append:function(t,r){if(0!==n.data.length)return e.append.call(e,t,r)},insertBefore:function(t,r){if(0!==n.data.length)return e.insertBefore.call(e,t,r)},insertAfter:function(t,r){if(0!==n.data.length)return e.insertAfter.call(e,t,r)},getChecked:function(t,r){if(0!==n.data.length)return e.getChecked.call(e,t,r)},setChecked:function(t,r){if(0!==n.data.length)return e.setChecked.call(e,t,r)},unCheckNodes:function(){if(0!==n.data.length)return e.unCheckNodes.call(e)},unCheckArrNodes:function(t){if(0!==n.data.length)return e.unCheckArrNodes.call(e,t)},expandAll:function(){n.elem.children(".eleTree-node").children(".eleTree-node-group").empty(),e.expandAll.call(e,n.data,[],1,!0),e.unCheckNodes(!0),e.defaultChecked(),e.checkboxInit()},unExpandAll:function(){return e.unExpandAll.call(e)},reload:function(n){return e.reload.call(e,n)},search:function(n){return e.search.call(e,n)}}},o=function(e,n,t){return["{{# for(var i=0;i<d.length;i++){ }}",'<div class="eleTree-node" data-'+e.request.key+'="{{d[i]["'+e.request.key+'"]}}" eletree-floor="'+n+'" style="display: none;">','<div class="eleTree-node-content" style="padding-left: '+e.indent*n+'px;">','<span class="eleTree-node-content-icon">','<i class="layui-icon layui-icon-triangle-r ',function(){if(e.lazy){var n=['{{# if(!d[i]["'+e.request.isLeaf+'"]){ }}','lazy-icon" ></i>',"{{# }else{ }}",'leaf-icon" style="color: transparent;" ></i>',"{{# } }}"].join("");return n}return['{{# if(!d[i]["'+e.request.children+'"] || d[i]["'+e.request.children+'"].length===0){ }}','leaf-icon" style="color: transparent;"',"{{# } }}",'"></i>'].join("")}(),"</span>",function(){if(e.showCheckbox){var n="";return n="1"===t?'"1" checked':"2"===t?'"2"':'"0"',['{{# if(d[i]["'+e.request.checked+'"]) { }}','<input type="checkbox" name="eleTree-node" eleTree-status="1" checked data-checked class="eleTree-hideen ',"{{# }else{ }}",'<input type="checkbox" name="eleTree-node" eleTree-status='+n+' class="eleTree-hideen ',"{{# } }}",'{{# if(d[i]["'+e.request.disabled+'"]) { }}',"eleTree-disabled","{{# } }}",'" />'].join("")}return""}(),'<span class="eleTree-node-content-label">{{d[i]["'+e.request.name+'"]}}</span>',"</div>",'<div class="eleTree-node-group">',"</div>","</div>","{{# } }}"].join("")},c=function(){return'<h3 class="eleTree-noText" style="text-align: center;height: 30px;line-height: 30px;color: #888;">{{d.emptText}}</h3>'},d=function(e){e.response=n.extend({},this.config.response,e.response),e.request=n.extend({},this.config.request,e.request),this.config=n.extend({},this.config,e),this.prevClickEle=null,this.nameIndex=1,this.render()};d.prototype={constructor:d,config:{elem:"",data:[],emptText:"暂无数据",renderAfterExpand:!0,highlightCurrent:!1,defaultExpandAll:!1,expandOnClickNode:!0,checkOnClickNode:!1,defaultExpandedKeys:[],autoExpandParent:!0,showCheckbox:!1,checkStrictly:!1,defaultCheckedKeys:[],accordion:!1,indent:16,lazy:!1,load:function(){},draggable:!1,contextmenuList:[],searchNodeMethod:null,method:"get",url:"",contentType:"",headers:{},done:null,response:{statusName:"code",statusCode:0,dataName:"data"},request:{name:"text",key:"value",children:"list",disabled:"disabled",checked:"checked",isLeaf:"isLeaf"}},render:function(){this.config.indent>30?this.config.indent=30:this.config.indent<10&&(this.config.indent=10);var e=this.config;return e.where=e.where||{},e.elem?(e.elem="string"==typeof e.elem?n(e.elem):e.elem,this.filter=e.elem.attr("lay-filter"),e.elem.append('<div class="eleTree-loadData"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i></div>'),void(0===e.data.length?this.ajaxGetData():this.renderData())):r.error("缺少elem参数")},renderData:function(){var e=this.config;t(o(e,0)).render(e.data,function(n){e.elem.html(n).children().show()}),e.lazy||(!e.renderAfterExpand||e.defaultExpandAll||e.defaultExpandedKeys.length>0||e.defaultCheckedKeys.length>0)&&this.expandAll(e.data,[],1),this.eleTreeEvent(),this.checkboxRender(),this.checkboxEvent(),this.defaultChecked(),this.nodeEvent(),this.rightClickMenu(),e.checkStrictly||this.checkboxInit()},ajaxGetData:function(){var e=this.config,i=this;if(!e.url)return void t(c()).render(e,function(n){e.elem.html(n)});var l=n.extend({},e.where);e.contentType&&0==e.contentType.indexOf("application/json")&&(l=JSON.stringify(l)),n.ajax({type:e.method||"get",url:e.url,contentType:e.contentType,data:l,dataType:"json",headers:e.headers||{},success:function(n){return n[e.response.statusName]==e.response.statusCode&&n[e.response.dataName]?(e.data=n[e.response.dataName],i.renderData(),void("function"==typeof e.done&&e.done(n))):(r.error("请检查数据格式是否符合规范"),void("function"==typeof e.done&&e.done(n)))}})},reload:function(e){return this.config.data&&this.config.data.constructor===Array&&(this.config.data=[]),this.config=n.extend({},this.config,e),n(this.config.elem).off(),l.render(this.config)},eleTreeEvent:function(){var e=this,r=this.config,i=r.expandOnClickNode?".eleTree-node-content":".eleTree-node-content>.eleTree-node-content-icon";r.elem.on("click",i,function(i){i.stopPropagation();var l=0===n(this).parent(".eleTree-node").length?n(this).parent(".eleTree-node-content"):n(this),a=l.parent(".eleTree-node"),c=l.siblings(".eleTree-node-group"),d=l.children(".eleTree-node-content-icon").children(".layui-icon");if(e.prevClickEle&&e.prevClickEle.removeClass("eleTree-node-content-active"),r.highlightCurrent&&l.addClass("eleTree-node-content-active"),e.prevClickEle=l,d.hasClass("icon-rotate"))return c.children(".eleTree-node:not(.eleTree-search-hide)").hide("fast"),void d.removeClass("icon-rotate");if(0===c.children(".eleTree-node").length){var s=Number(a.attr("eletree-floor"))+1,h=e.reInitData(a),u=h.currentData;if(r.lazy&&d.hasClass("lazy-icon"))d.removeClass("layui-icon-triangle-r").addClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),r.load(u,function(n){u[r.request.children]=n;var i=l.children("input.eleTree-hideen").attr("eletree-status");u[r.request.children]&&u[r.request.children].length>0?t(o(r,s,i)).render(u[r.request.children],function(e){c.append(e).children().show("fast")}):d.css("color","transparent").addClass("leaf-icon"),d.removeClass("lazy-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop").addClass("layui-icon-triangle-r icon-rotate"),e.checkboxRender()});else{var f=l.children("input.eleTree-hideen").attr("eletree-status");u[r.request.children]&&u[r.request.children].length>0&&t(o(r,s,f)).render(u[r.request.children],function(e){c.append(e)});var p=c.children(".eleTree-node").eq(0);if(0===p.length)return void e.checkboxRender();var T=p.siblings(".eleTree-node"),v=p.children(".eleTree-node-content").children(".eleTree-hideen").get(0);e.selectParents(v,p,T),e.checkboxRender()}}if(c.children(".eleTree-node:not(.eleTree-search-hide)").show("fast"),d.addClass("icon-rotate"),r.accordion){var g=l.parent(".eleTree-node").siblings(".eleTree-node");g.children(".eleTree-node-group").children(".eleTree-node:not(.eleTree-search-hide)").hide("fast"),g.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").removeClass("icon-rotate")}})},checkboxEvent:function(){var e=this.config,t=this,r=e.checkOnClickNode?".eleTree-node-content":".eleTree-checkbox";e.elem.on("click",r,function(r,l){r.stopPropagation();var a=0===n(this).parent(".eleTree-node").length?n(this).parent(".eleTree-node-content"):n(this),o=a.children(".eleTree-checkbox");if(!o.hasClass("eleTree-checkbox-disabled")){var c=(a.parent(".eleTree-node"),o.siblings(".eleTree-hideen").get(0)),d=a.siblings(".eleTree-node-group").find("input[name='eleTree-node']");if(t.prevClickEle&&t.prevClickEle.removeClass("eleTree-node-content-active"),e.highlightCurrent&&a.addClass("eleTree-node-content-active"),t.prevClickEle=a,c){c.checked?(n(c).prop("checked",!1).attr("eleTree-status","0"),e.checkStrictly||(d.prop("checked",!1),d.attr("eleTree-status","0"))):(n(c).prop("checked",!0).attr("eleTree-status","1"),e.checkStrictly||d.prop("checked",!0).attr("eleTree-status","1"));var s=a.parent(".eleTree-node");if(!e.checkStrictly){var h=s.siblings(".eleTree-node");t.selectParents(c,s,h)}t.checkboxRender(),"default"!==l&&layui.event.call(c,i,"nodeChecked("+t.filter+")",{node:s,data:t.reInitData(s),isChecked:c.checked})}}})},checkboxInit:function(){var e=this.config,t=this;e.elem.find("input[data-checked]").each(function(e,r){var i=n(r).siblings(".eleTree-checkbox"),l=i.parent(".eleTree-node-content").siblings(".eleTree-node-group").find("input[name='eleTree-node']");n(r).prop("checked","checked").attr("eleTree-status","1"),i.addClass("eleTree-checkbox-checked"),i.children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line"),l.prop("checked","checked").attr("eleTree-status","1"),l.siblings(".eleTree-checkbox").addClass("eleTree-checkbox-checked"),l.siblings(".eleTree-checkbox").children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line");var a=i.parent(".eleTree-node-content").parent(".eleTree-node"),o=a.siblings(".eleTree-node");t.selectParents(r,a,o)}),t.checkboxRender()},selectParents:function(e,t,r){for(;0!==Number(t.attr("eletree-floor"));){var i=[];i.push(n(e).attr("eleTree-status")),r.each(function(e,t){var r=n(t).children(".eleTree-node-content").children("input[name='eleTree-node']").attr("eleTree-status");i.push(r)});var l=t.parent(".eleTree-node-group").siblings(".eleTree-node-content").children("input[name='eleTree-node']"),a=l.siblings(".eleTree-checkbox");i.every(function(e){return"1"===e})&&l.prop("checked",!0).attr("eleTree-status","1"),i.some(function(e){return"0"===e||"2"===e})&&l.attr("eleTree-status","2"),i.every(function(e){return"0"===e})&&(l.prop("checked",!1),l.attr("eleTree-status","0"));var o=t.parents("[eletree-floor='"+(Number(t.attr("eletree-floor"))-1)+"']"),a=o.children(".eleTree-node-content").children("input[name='eleTree-node']").get(0),c=o.siblings(".eleTree-node");t=o,e=a,r=c}},expandAll:function(e,r,i,l){var a=this.config,c=this;e.forEach(function(e,d){if(r.push(d),e[a.request.children]&&e[a.request.children].length>0){for(var s=a.elem.children(".eleTree-node").eq(r[0]).children(".eleTree-node-group"),h=1;h<r.length;h++)s=s.children(".eleTree-node").eq(r[h]).children(".eleTree-node-group");t(o(a,i)).render(e[a.request.children],function(e){if(s.append(e),a.defaultExpandAll||l)s.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),s.children().show();else if(a.defaultExpandedKeys.length>0){var t=function(e){a.autoExpandParent&&e.parents(".eleTree-node").each(function(e,t){n(t).attr("data-"+a.request.key)&&(n(t).children(".eleTree-node-group").siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),n(t).children(".eleTree-node-group").children().show())})},r=s.parent(".eleTree-node").attr("data-"+a.request.key);r=isNaN(r)?r:Number(r),n.inArray(r,a.defaultExpandedKeys)!==-1?(s.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),s.children().show(),t(s.parent(".eleTree-node[data-"+a.request.key+"]"))):s.children(".eleTree-node").each(function(e,r){var i=n(r).attr("data-"+a.request.key);if(i=isNaN(i)?i:Number(i),n.inArray(i,a.defaultExpandedKeys)!==-1)return t(n(r)),!1})}}),i++,c.expandAll(e[a.request.children],r,i,l),i--}r.pop()})},defaultChecked:function(){var e=this.config;if(0===e.defaultCheckedKeys.length)return!1;if(e.checkStrictly)return e.defaultCheckedKeys.forEach(function(n,t){var r=e.elem.find("[data-"+e.request.key+"='"+n+"']").children(".eleTree-node-content");r.children(".eleTree-hideen").prop("checked")===!1&&r.children(".eleTree-checkbox").trigger("click",["default"])}),!1;var t=n.extend([],e.defaultCheckedKeys);e.defaultCheckedKeys.forEach(function(r,i){e.elem.find("[data-"+e.request.key+"='"+r+"']").find("[data-"+e.request.key+"]").each(function(r,i){var l=n(i).attr("data-"+e.request.key);l=isNaN(l)?l:Number(l);var a=n.inArray(l,t);a!==-1&&t.splice(a,1)})}),t.forEach(function(n,t){var r=e.elem.find("[data-"+e.request.key+"='"+n+"']").children(".eleTree-node-content");r.children(".eleTree-hideen").prop("checked")===!1&&r.children(".eleTree-checkbox").trigger("click",["default"])})},checkboxRender:function(){var e=this.config;e.elem.find(".eleTree-checkbox").remove(),e.elem.find("input.eleTree-hideen[type=checkbox]").each(function(e,t){n(t).hasClass("eleTree-disabled")?n(t).after('<div class="eleTree-checkbox eleTree-checkbox-disabled"><i class="layui-icon"></i></div>'):n(t).after('<div class="eleTree-checkbox"><i class="layui-icon"></i></div>');var r=n(t).siblings(".eleTree-checkbox");"1"===n(t).attr("eletree-status")?(r.addClass("eleTree-checkbox-checked"),r.children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line")):"0"===n(t).attr("eletree-status")?(r.removeClass("eleTree-checkbox-checked"),r.children("i").removeClass("layui-icon-ok eleTree-checkbox-line")):"2"===n(t).attr("eletree-status")&&(r.addClass("eleTree-checkbox-checked"),r.children("i").removeClass("layui-icon-ok").addClass("eleTree-checkbox-line"))})},reInitData:function(e){for(var n=this.config,t=e.index(),r=Number(e.attr("eletree-floor")),i=[];r>=0;)i.push(t),r-=1,e=e.parents("[eletree-floor='"+r+"']"),t=e.index();i=i.reverse();for(var l=this.config.data,a=l[i[0]],o=l[i[0]],t=1;t<i.length;t++)o=o[n.request.children]?o[n.request.children][i[t]]:o;for(var t=1;t<i.length-1;t++)a=a[n.request.children]?a[n.request.children][i[t]]:a;return{currentData:o,parentData:{data:a,childIndex:i[i.length-1]},index:i}},keySearchToOpera:function(e,n){var t=this.config,r=function(i){for(var l={i:0,len:i.length};l.i<l.len;l.i++)i[l.i][t.request.key]!==e?i[l.i][t.request.children]&&i[l.i][t.request.children].length>0&&r(i[l.i][t.request.children]):n(i,l)};r(t.data)},updateKeyChildren:function(e,r){var i=this.config,l=i.elem.find("[data-"+i.request.key+"='"+e+"']"),a=Number(l.attr("eletree-floor"))+1,c=this;this.keySearchToOpera(e,function(e,d){e[d.i][i.request.children]=r,0!==l.length&&t(o(i,a)).render(r,function(e){n(l).children(".eleTree-node-group").empty().append(e),i.defaultExpandAll&&n(l).children(".eleTree-node-group").children().show()}),c.unCheckNodes(!0),c.defaultChecked(),c.checkboxInit()})},updateKeySelf:function(e,t){var r=this.config,i=r.elem.find("[data-"+r.request.key+"='"+e+"']").children(".eleTree-node-content");Number(i.attr("eletree-floor"))+1;t[r.request.name]&&i.children(".eleTree-node-content-label").text(t[r.request.name]),t[r.request.disabled]&&i.children(".eleTree-hideen").addClass("eleTree-disabled").siblings(".eleTree-checkbox").addClass("eleTree-checkbox-disabled");this.keySearchToOpera(e,function(e,i){t[r.request.key]=e[i.i][r.request.key],t[r.request.children]=e[i.i][r.request.children],e[i.i]=n.extend({},e[i.i],t),console.log(r.data)})},remove:function(e){var n=this.config,t=n.elem.find("[data-"+n.request.key+"='"+e+"']"),r=t.parent(".eleTree-node-group");this.keySearchToOpera(e,function(i,l){i.splice(l.i,1),l.i--,l.len--,0!==t.length&&n.elem.find("[data-"+n.request.key+"='"+e+"']").remove(),0===r.children(".eleTree-node").length&&r.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").css("color","transparent")}),this.unCheckNodes(!0),this.defaultChecked(),this.checkboxInit()},append:function(e,n){var r=this.config,i=r.elem.find("[data-"+r.request.key+"='"+e+"']"),l=Number(i.attr("eletree-floor"))+1;this.keySearchToOpera(e,function(e,a){e[a.i][r.request.children]?e[a.i][r.request.children].push(n):e[a.i][r.request.children]=[n];var c=e[a.i][r.request.children];1===c.length&&i.children(".eleTree-node-content").find(".eleTree-node-content-icon .layui-icon").removeAttr("style").addClass("icon-rotate");var d=c.length,s=i.children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");s="2"===s?"0":s,0!==i.length&&t(o(r,l,s)).render([c[d-1]],function(e){i.children(".eleTree-node-group").append(e).children().show()})}),this.checkboxRender()},insertBefore:function(e,n){var r=this.config,i=r.elem.find("[data-"+r.request.key+"='"+e+"']"),l=Number(i.attr("eletree-floor"));this.keySearchToOpera(e,function(e,a){e.splice(a.i,0,n),a.i++,a.len++;var c=0===i.parent(".eleTree-node-group").length?"0":i.parent(".eleTree-node-group").parent(".eleTree-node").children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");c="2"===c?"0":c,0!==i.length&&t(o(r,l,c)).render([n],function(e){i.before(e).prev(".eleTree-node").show()})}),this.checkboxRender()},insertAfter:function(e,r){var i=this.config,l=i.elem.find("[data-"+i.request.key+"='"+e+"']"),a=Number(l.attr("eletree-floor"));this.keySearchToOpera(e,function(e,c){e.splice(c.i+1,0,r),c.i++,c.len++;var d=0===l.parent(".eleTree-node-group").length?"0":l.parent(".eleTree-node-group").parent(".eleTree-node").children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");d="2"===d?"0":d,0!==l.length&&t(o(i,a,d)).render([r],function(e){n(l).after(e).next(".eleTree-node").show()})}),this.checkboxRender()},getChecked:function(e,t){var r,i=this.config,l=[];return e=e||!1,t=t||!1,r=e?i.elem.find(".layui-icon.leaf-icon").parent(".eleTree-node-content-icon").siblings("input.eleTree-hideen[eletree-status='1']"):t?i.elem.find("input.eleTree-hideen[eletree-status='1'],input.eleTree-hideen[eletree-status='2']"):i.elem.find("input.eleTree-hideen[eletree-status='1']"),r.each(function(e,t){var r={},a=n(t).parent(".eleTree-node-content").parent(".eleTree-node").attr("data-"+i.request.key);a=isNaN(a)?a:Number(a);var o=n(t).siblings(".eleTree-node-content-label").text();r[i.request.key]=a,r[i.request.name]=o,r.elem=t,r.othis=n(t).siblings(".eleTree-checkbox").get(0),l.push(r)}),l},setChecked:function(e,t){var r=this.config;t=t||!1,t?(this.unCheckNodes(),r.defaultCheckedKeys=n.extend([],e)):(this.unCheckNodes(!0),e.forEach(function(e){n.inArray(e,r.defaultCheckedKeys)===-1&&r.defaultCheckedKeys.push(e)})),this.defaultChecked(),this.checkboxInit()},unCheckNodes:function(e){e=e||!1;var t=this.config;t.elem.find("input.eleTree-hideen[eletree-status='1'],input.eleTree-hideen[eletree-status='2']").each(function(t,r){n(r).attr("eletree-status","0").prop("checked",!1),e||n(r).removeAttr("data-checked")}),this.checkboxRender()},unCheckArrNodes:function(e){var n=this.config;e.forEach(function(e,t){var r=n.elem.find(".eleTree-node[data-"+n.request.key+"='"+e+"']").children(".eleTree-node-content").children(".eleTree-hideen[eletree-status='1'],.eleTree-hideen[eletree-status='2']");r.length>0&&r.prop("checked",!0).removeAttr("data-checked").siblings(".eleTree-checkbox").trigger("click")})},unExpandAll:function(){var e=this.config;e.elem.find(".layui-icon.icon-rotate").removeClass("icon-rotate").parent(".eleTree-node-content-icon").parent(".eleTree-node-content").siblings(".eleTree-node-group").children(".eleTree-node").hide()},nodeEvent:function(){var e=this,t=this.config;t.elem.on("click",".eleTree-node-content",function(t){var r=n(this).parent(".eleTree-node");n("#tree-menu").hide().remove(),layui.event.call(r,i,"nodeClick("+e.filter+")",{node:r,data:e.reInitData(r),event:t})}),t.elem.on("contextmenu",".eleTree-node-content",function(t){var r=n(this).parent(".eleTree-node");layui.event.call(r,i,"nodeContextmenu("+e.filter+")",{node:r,data:e.reInitData(r),event:t})}),t.draggable&&t.elem.on("mousedown",".eleTree-node-content",function(r){var l=0,a=n(this).parent(".eleTree-node"),o=Number(a.attr("eletree-floor")),c=a.parent(".eleTree-node-group");r.stopPropagation(),t.elem.css("user-select","none");var d=a.clone(!0),s=a.clone(!0);r.clientX-t.elem.offset().left,r.clientY-t.elem.offset().top;t.elem.append(d),d.css({display:"none",opacity:.7,position:"absolute","background-color":"#f5f5f5",width:"100%"});var h=e.reInitData(a),u=!1;n(document).on("mousemove",function(e){if(l++,l>2){var r=e.clientX-t.elem.offset().left+10,i=e.clientY-t.elem.offset().top+n(document).scrollTop()-5;d.css({display:"block",left:r+"px",top:i+"px"})}}).on("mouseup",function(r){n(document).off("mousemove").off("mouseup");var l=n(r.target).parents(".eleTree-node").eq(0);d.remove(),t.elem.css("user-select","auto");var f=a.parent().get(0).isEqualNode(t.elem.get(0)),p=n(r.target).get(0).isEqualNode(t.elem.get(0));if(p&&(l=t.elem),(0!==l.parents(t.elem).length||p)&&!l.get(0).isEqualNode(a.get(0))){var T=l.attr("eletree-floor"),v=!1;if(a.find("[eletree-floor='"+T+"']").each(function(){this.isEqualNode(l.get(0))&&(v=!0)}),!v){var g=e.reInitData(l);if(layui.event.call(l,i,"nodeDrag("+e.filter+")",{current:{node:a,data:h},target:{node:l,data:g},stop:function(){u=!0}}),u)return!1;var k=h.parentData.data[t.request.children],m=h.parentData.childIndex,y=h.currentData,b=g.currentData;if(f?t.data.splice(m,1):k.splice(m,1),p?t.data.push(y):function(){b[t.request.children]?"":b[t.request.children]=[],b[t.request.children].push(y)}(),a.remove(),p){l.append(s);var x=0}else{l.children(".eleTree-node-group").append(s);var x=Number(l.attr("eletree-floor"))+1}s.attr("eletree-floor",String(x)),s.children(".eleTree-node-content").css("padding-left",x*t.indent+"px");var C=o-x;s.find(".eleTree-node").each(function(e,r){var i=Number(n(r).attr("eletree-floor"))-C;n(r).attr("eletree-floor",String(i)),n(r).children(".eleTree-node-content").css("padding-left",i*t.indent+"px")});var q=0===c.children(".eleTree-node").length;q&&c.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").removeClass("icon-rotate").css("color","transparent");var N=0===l.children(".eleTree-node-group").children(".eleTree-node").length;!N&&l.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate").removeAttr("style"),e.unCheckNodes(!0),e.defaultChecked(),e.checkboxInit()}}})})},rightClickMenu:function(){var e=this,t=this.config;if(!(t.contextmenuList.length<=0)){n(document).on("click",function(){n("#tree-menu").hide().remove()});var r=['<ul id="tree-menu">',n.inArray("copy",t.contextmenuList)!==-1?'<li class="copy"><a href="javascript:;">复制</a></li>':"",n.inArray("add",t.contextmenuList)!==-1?'<li class="add"><a href="javascript:;">新增</a></li><li class="insertBefore"><a href="javascript:;">插入节点前</a></li><li class="insertAfter"><a href="javascript:;">插入节点后</a></li><li class="append"><a href="javascript:;">插入子节点</a></li>':"",n.inArray("edit",t.contextmenuList)!==-1?'<li class="edit"><a href="javascript:;">修改</a></li>':"",n.inArray("remove",t.contextmenuList)!==-1?'<li class="remove"><a href="javascript:;">删除</a></li>':"","</ul>"].join("");this.treeMenu=n(r),t.elem.off("contextmenu").on("contextmenu",".eleTree-node-content",function(r){var l=this;r.stopPropagation(),r.preventDefault(),e.prevClickEle&&e.prevClickEle.removeClass("eleTree-node-content-active"),n(this).addClass("eleTree-node-content-active");var a=n(this).parent(".eleTree-node"),o=e.reInitData(a);n(document.body).after(e.treeMenu),n("#tree-menu li.insertBefore,#tree-menu li.insertAfter,#tree-menu li.append").hide(),n("#tree-menu li.copy,#tree-menu li.add,#tree-menu li.edit,#tree-menu li.remove").show(),n("#tree-menu").css({left:r.pageX,top:r.pageY}).show(),n("#tree-menu li.copy").off().on("click",function(){var e=n(l).children(".eleTree-node-content-label").get(0),t=window.getSelection(),r=document.createRange();r.selectNodeContents(e),t.removeAllRanges(),t.addRange(r),document.execCommand("Copy","false",null),t.removeAllRanges()}),n("#tree-menu li.add").off().on("click",function(e){e.stopPropagation(),n(this).hide().siblings("li.copy,li.edit,li.remove").hide(),n(this).siblings(".append,li.insertAfter,li.insertBefore").show()});var c={};c[t.request.key]=Date.now(),c[t.request.name]="未命名"+e.nameIndex;var d=["Append","InsertBefore","InsertAfter"];d.forEach(function(r){var a=r[0].toLocaleLowerCase()+r.slice(1,r.length);n("#tree-menu li."+a).off().on("click",function(a){var d=n(l).parent(".eleTree-node"),s=d.attr("data-"+t.request.key);s=isNaN(s)?s:Number(s);var h=!1,u=r[0].toLocaleLowerCase()+r.slice(1,r.length);layui.event.call(d,i,"node"+r+"("+e.filter+")",{node:d,data:o.currentData,newData:c,setData:function(t){var r=n.extend({},c,t);this.newData=r,e[u](s,r),h=!0},stop:function(){h=!0}}),h||(e[u](s,c),e.nameIndex++)})}),n("#tree-menu li.edit").off().on("click",function(r){r.stopPropagation(),n("#tree-menu").hide().remove();var c=n(l).parent(".eleTree-node"),d=c.attr("data-"+t.request.key);d=isNaN(d)?d:Number(d);var s=n(l).children(".eleTree-node-content-label").hide(),h=s.text(),u="<input type='text' value='"+h+"' class='eleTree-node-content-input' />";s.after(u),s.siblings(".eleTree-node-content-input").focus().select().off().on("blur",function(){var r=n(this).val(),l=!1,d=this;layui.event.call(c,i,"nodeEdit("+e.filter+")",{node:c,value:r,data:o.currentData,stop:function(){l=!0,n(d).siblings(".eleTree-node-content-label").show(),n(d).remove()}}),l||(e.reInitData(a).currentData[t.request.name]=r,n(this).siblings(".eleTree-node-content-label").text(r).show(),n(this).remove())}).on("mousedown",function(e){e.stopPropagation()})}),n("#tree-menu li.remove").off().on("click",function(r){var a=n(l).parent(".eleTree-node"),c=a.attr("data-"+t.request.key);c=isNaN(c)?c:Number(c);var d=!1;layui.event.call(a,i,"nodeRemove("+e.filter+")",{node:a,data:o.currentData,stop:function(){d=!0}}),d||e.remove(c)}),e.prevClickEle=n(this)})}},search:function(e){var n=this.config;if(n.searchNodeMethod&&"function"==typeof n.searchNodeMethod){var r=n.data,i=function(t){t.forEach(function(t,r){if(t.visible=n.searchNodeMethod(e,t),t[n.request.children]&&t[n.request.children].length>0&&i(t[n.request.children]),!t.visible){var l=!1;t[n.request.children]&&t[n.request.children].length>0&&(l=t[n.request.children].some(function(e,n){return e.visible})),t.visible=l}var a=n.elem.find("[data-"+n.request.key+"='"+t[n.request.key]+"']");if(t.visible){a.removeClass("eleTree-search-hide");var o=a.parent(".eleTree-node-group").parent(".eleTree-node"),c=o.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon.layui-icon-triangle-r").hasClass("icon-rotate");(o.length>0&&c||0===o.length)&&a.show()}else a.hide().addClass("eleTree-search-hide");t[n.request.children]&&t[n.request.children].length>0&&t[n.request.children].forEach(function(e,n){delete e.visible})})};i(r);var l=[];r.forEach(function(e){l.push(e.visible),delete e.visible}),l.every(function(e){return e===!1})?t(c()).render(n,function(e){n.elem.append(e)}):n.elem.children(".eleTree-noText").remove()}}},e(i,l)});